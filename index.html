<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Weather App" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Weather Display</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .wrapper {
      position: relative;
      width: 1133px;
      height: 744px;
    }

    .wrapper img {
      width: 100%;
      height: 100%;
      display: block;
    }

    .field {
      position: absolute;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 33px;
      text-shadow: 0 0 5px black;
      /* outline: 1px dashed lime; */ /* Use this to debug placement */
    }

    /* Adjust these to match your image layout */
    .datetime   { top: 65px;  left: 758px; }
    .weather    { top: 111px; left: 758px; }
    .uv         { top: 157px; left: 758px; }
    .wind       { top: 203px; left: 758px; }
    .temp       { top: 65px; left: 388px; }
    .humidity   { top: 107px; left: 388px; }
    .pm25       { top: 157px; left: 388px; }
    .rainfall   { top: 203px; left: 388px; }
    
  </style>
</head>
<body>
  <div class="wrapper">
    <img src="bg.png" alt="Weather Background" id="bg-image">

    <div class="field datetime"></div>
    <div class="field temp"></div>
    <div class="field humidity"></div>
    <div class="field weather">Cloudy</div>
    <div class="field pm25">PM<sub>2.5</sub>: 18 ¬µg/m¬≥</div>
    <div class="field uv">UV Index: 6</div>
    <div class="field rainfall">Rainfall: 0 mm</div>
    <div class="field wind">Wind: NE 15 km/h</div>
  </div>

<script>
function formatDateTime(date) {
  const pad = n => n.toString().padStart(2, '0');
  const day = pad(date.getDate()), month = pad(date.getMonth()+1), year = date.getFullYear();
  const hour = pad(date.getHours()), min = pad(date.getMinutes()), sec = pad(date.getSeconds());
  return `${day}/${month}/${year} ${hour}:${min}:${sec}`;
}

function updateClock() {
  document.querySelector('.datetime').innerText = formatDateTime(new Date());
}
updateClock();
setInterval(updateClock, 1000);

// üîÅ This function handles all weather fetching (air temp for now)
function updateWeather() {
  fetch('https://api-open.data.gov.sg/v2/real-time/api/air-temperature')
    .then(function (res) {
      return res.json();
    })
    .then(function (data) {
      if (
        !data ||
        typeof data !== 'object' ||
        !data.data ||
        !Array.isArray(data.data.readings) ||
        data.data.readings.length === 0 ||
        !Array.isArray(data.data.readings[0].data)
      ) {
        console.log('Invalid air temp structure');
        document.querySelector('.temp').innerText = 'N/A';
        return;
      }

      var readings = data.data.readings[0].data;
      var selected = null;

      for (var i = 0; i < readings.length; i++) {
        if (readings[i].stationId === 'S109') {
          selected = readings[i];
          break;
        }
      }

      if (!selected && readings.length > 0) {
        selected = readings[0];
      }

      if (selected) {
        document.querySelector('.temp').innerText = 'üå°Ô∏è ' + selected.value + '¬∞C';
      } else {
        document.querySelector('.temp').innerText = 'N/A';
      }
    })
    .catch(function (err) {
      console.error('Error fetching air temperature:', err);
      document.querySelector('.temp').innerText = 'Error';
    });

  // --- Fetch relative humidity ---
  fetch('https://api-open.data.gov.sg/v2/real-time/api/relative-humidity')
    .then(function (res) { return res.json(); })
    .then(function (data) {
      var readings = data?.data?.readings?.[0]?.data || [];
      var selected = null;

      for (var i = 0; i < readings.length; i++) {
        if (readings[i].stationId === 'S109') {
          selected = readings[i];
          break;
        }
      }

      if (!selected && readings.length > 0) {
        selected = readings[0];
      }

      if (selected) {
        document.querySelector('.humidity').innerText = 'üíß ' + selected.value + '%';
      } else {
        document.querySelector('.humidity').innerText = 'N/A';
      }
    })
    .catch(function (err) {
      console.error('Humidity error:', err);
      document.querySelector('.humidity').innerText = 'Error';
    });
  
}

// Call once at page load
updateWeather();

// Optionally call every hour (3600000 ms)
setInterval(updateWeather, 3600000);
</script>
</body>
</html>
