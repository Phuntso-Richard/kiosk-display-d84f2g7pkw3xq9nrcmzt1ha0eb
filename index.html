<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Weather App" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Weather Display</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .wrapper {
      position: relative;
      width: 1133px;
      height: 744px;
    }

    .wrapper img {
      width: 100%;
      height: 100%;
      display: block;
    }

    .field {
      position: absolute;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 33px;
      text-shadow: 0 0 5px black;
      /* outline: 1px dashed lime; */ /* Use this to debug placement */
    }

  .pm25 sub {
    font-size: 60%;
    vertical-align: sub;
  }
    
    /* Adjust these to match your image layout */
    .datetime   { top: 65px;  left: 758px; }
    .thermo     { top: 59px; left: 389px; }
    .weather    { top: 111px; left: 758px; }
    .uv         { top: 157px; left: 758px; }
    .wind       { top: 203px; left: 758px; }
    .temp       { top: 64px; left: 429px; }
    .humidity   { top: 107px; left: 388px; }
    .pm25       { top: 157px; left: 388px; }
    .rainfall   { top: 203px; left: 388px; }

.weather-emoji {
  top: 8px;            /* Adjust Y position as needed */
  left: 72px;         /* Adjust X position as needed */
  font-size: 220px;      /* Make it big */
  position: absolute;
  font-family: Arial, sans-serif;
  text-shadow: 0 0 5px black;
  color: white;
}
    
  </style>
</head>
<body>
  <div class="wrapper">
    <img src="bg.png" alt="Weather Background" id="bg-image">

    <div class="field datetime"></div>
    <div class="field temp"></div>
    <div class="field humidity"></div>
    <div class="field weather"></div>
    <div class="field thermo">ðŸŒ¡</div>
    <div class="field pm25"></div>
    <div class="field uv">UV Index: 6</div>
    <div class="field rainfall">Rainfall: 0 mm</div>
    <div class="field wind">Wind: NE 15 km/h</div>
    <div class="field weather-emoji"></div>
  </div>

<script>
function formatDateTime(date) {
  const pad = n => n.toString().padStart(2, '0');
  const day = pad(date.getDate()), month = pad(date.getMonth() + 1), year = date.getFullYear();
  const hour = pad(date.getHours()), min = pad(date.getMinutes()), sec = pad(date.getSeconds());
  return `${day}/${month}/${year} ${hour}:${min}:${sec}`;
}

function updateClock() {
  document.querySelector('.datetime').innerText = formatDateTime(new Date());
}
updateClock();
setInterval(updateClock, 1000);

function getWeatherEmoji(forecast) {
  const emojiMap = {
    'Fair': 'ðŸŒ¤ï¸',
    'Fair (Day)': 'â˜€ï¸',
    'Fair (Night)': 'ðŸŒ™',
    'Fair and Warm': 'ðŸ”†',
    'Partly Cloudy': 'ðŸŒ¤ï¸',
    'Partly Cloudy (Day)': 'ðŸŒ¤ï¸',
    'Partly Cloudy (Night)': 'â˜ï¸',
    'Cloudy': 'â˜ï¸',
    'Hazy': 'ðŸŒ«ï¸',
    'Slightly Hazy': 'ðŸŒ«ï¸',
    'Windy': 'ðŸŒ¬ï¸',
    'Mist': 'ðŸŒ',
    'Fog': 'ðŸŒ',
    'Light Rain': 'ðŸŒ¦ï¸',
    'Moderate Rain': 'ðŸŒ§ï¸',
    'Heavy Rain': 'ðŸŒ§ï¸',
    'Passing Showers': 'ðŸŒ¦ï¸',
    'Light Showers': 'ðŸŒ¦ï¸',
    'Showers': 'ðŸŒ§ï¸',
    'Heavy Showers': 'ðŸŒ§ï¸',
    'Thundery Showers': 'â›ˆï¸',
    'Heavy Thundery Showers': 'â›ˆï¸'
  };
  return emojiMap[forecast] || '';
}

function updateWeather() {
  // --- Fetch air temperature ---
  fetch('https://api-open.data.gov.sg/v2/real-time/api/air-temperature')
    .then(res => res.json())
    .then(data => {
      const readings = data?.data?.readings?.[0]?.data || [];
      const selected = readings.find(r => r.stationId === 'S109') || readings[0];
      const tempText = selected?.value !== undefined ? selected.value + 'Â°C' : 'N/A';
      document.querySelector('.temp').innerText = tempText;
    })
    .catch(err => {
      console.error('Air temp error:', err);
      document.querySelector('.temp').innerText = 'Error';
    });

  // --- Fetch relative humidity ---
  fetch('https://api-open.data.gov.sg/v2/real-time/api/relative-humidity')
    .then(res => res.json())
    .then(data => {
      const readings = data?.data?.readings?.[0]?.data || [];
      const selected = readings.find(r => r.stationId === 'S109') || readings[0];
      const humidityText = selected?.value !== undefined ? `ðŸ’§ ${selected.value}%` : 'N/A';
      document.querySelector('.humidity').innerText = humidityText;
    })
    .catch(err => {
      console.error('Humidity error:', err);
      document.querySelector('.humidity').innerText = 'Error';
    });

  // --- Fetch weather forecast ---
  fetch('https://api-open.data.gov.sg/v2/real-time/api/two-hr-forecast')
    .then(res => res.json())
    .then(data => {
      const items = data?.data?.items;
      if (!items || items.length === 0) {
        document.querySelector('.weather').innerText = 'Unavailable';
        document.querySelector('.weather-emoji').innerText = '';
        return;
      }

      const forecasts = items[0]?.forecasts || [];
      const selected = forecasts.find(f => f.area === 'Punggol') || forecasts[0];
      const rawForecast = selected?.forecast || 'N/A';
      const cleaned = rawForecast.replace(' with Gusty Winds', '').trim();

      document.querySelector('.weather').innerText = cleaned;
      document.querySelector('.weather-emoji').innerText = getWeatherEmoji(cleaned);
    })
    .catch(err => {
      console.error('Forecast error:', err);
      document.querySelector('.weather').innerText = 'Error';
      document.querySelector('.weather-emoji').innerText = 'âŒ';
    });
}

// --- Fetch PM2.5 ---
fetch('https://api-open.data.gov.sg/v2/real-time/api/pm25')
  .then(res => res.json())
  .then(data => {
    const pm25Readings = data?.data?.items?.[0]?.readings?.pm25_one_hourly || {};
    let value = pm25Readings['north'];
    if (value === undefined) {
      // pick first available region value if north not found
      const firstKey = Object.keys(pm25Readings)[0];
      value = pm25Readings[firstKey];
    }
    document.querySelector('.pm25').innerHTML = 'PM<sub>2.5</sub>: ' + (value !== undefined ? value : 'N/A') + ' Âµg/mÂ³';
  })
  .catch(err => {
    console.error('PM2.5 error:', err);
    document.querySelector('.pm25').innerText = 'Error';
  });
  
updateWeather();
setInterval(updateWeather, 3600000);
</script>
</body>
</html>
